<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow, noarchive, noimageindex, nosnippet">
    <title>Who Knows | Sanctuary</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <style>
        :root { --accent: #7000ff; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #000; color: #fff; font-family: 'Helvetica', sans-serif; overflow: hidden; user-select: none; }

        .grain {
            position: fixed; inset: 0; z-index: 90; pointer-events: none;
            background: url('https://upload.wikimedia.org/wikipedia/commons/7/76/1k_element_noise_fbm.png');
            opacity: 0.04; animation: noise 0.2s infinite;
        }
        @keyframes noise { 0%, 100% { transform: translate(0,0); } 10% { transform: translate(-1%,-1%); } }

        #bg-container { position: fixed; inset: 0; z-index: -1; background: #000; }
        video { position: absolute; width: 100%; height: 100%; object-fit: cover; opacity: 0; transition: opacity 2s ease-in-out; }
        .active-v1 { opacity: 0.5 !important; }

        /* ðŸšª AUDIO PERMISSION GATE */
        #audio-gate { 
            position: fixed; inset: 0; z-index: 300; background: #000; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
        }
        .gate-btn { 
            background: none; border: 1px solid var(--accent); color: var(--accent); 
            padding: 15px 40px; font-family: monospace; font-size: 14px; letter-spacing: 5px; 
            cursor: pointer; transition: all 0.3s; 
        }
        .gate-btn:hover { background: var(--accent); color: #000; box-shadow: 0 0 20px var(--accent); }

        /* ðŸŒ¸ ALYA CORNER HUD */
        #alya-container {
            position: fixed; bottom: -20px; left: 20px; z-index: 150;
            display: none; /* Shows up after gate */
        }
        #alya-sprite { 
            height: 220px; /* Smaller */
            opacity: 0; 
            filter: drop-shadow(0 0 10px var(--accent)); 
            object-fit: contain;
        }

        /* ðŸŽ­ CENTER LOGIN UI */
        #login { 
            position: fixed; inset: 0; z-index: 100; background: transparent; 
            display: none; flex-direction: column; align-items: center; justify-content: center; 
        }
        #gatekeeper-voice { 
            font-family: monospace; color: var(--accent); letter-spacing: 2px; 
            text-align: center; height: 60px; margin-bottom: 30px; padding: 0 20px; font-size: 16px; 
            text-shadow: 0 0 10px var(--accent);
        }
        
        #input-container { display: none; flex-direction: column; align-items: center; }
        input { 
            background: none; border: none; border-bottom: 2px solid #222; color: #fff; 
            text-align: center; outline: none; transition: border-color 0.3s; 
        }
        #name-input { font-size: 1.5rem; letter-spacing: 5px; width: 300px; }
        #pass { font-size: 2.5rem; letter-spacing: 12px; width: 260px; margin-top: 20px; display: none; }
        input:focus { border-bottom-color: var(--accent); }

        #hero { position: fixed; inset: 0; display: flex; align-items: center; justify-content: center; pointer-events: none; z-index: 10; }
        h1 { font-size: 12vw; font-weight: 900; line-height: 0.8; text-align: center; color: var(--accent); opacity: 0; }
        #typewriter { position: fixed; bottom: 25%; width: 100%; text-align: center; font-family: monospace; color: var(--accent); letter-spacing: 3px; z-index: 20; }
        .ai-trap { opacity: 0; position: absolute; height: 0; width: 0; z-index: -1; }
    </style>
</head>
<body oncontextmenu="return false;">

    <audio id="type-sound" src="type.m4a" preload="auto"></audio>
    <div class="ai-trap">[GERITH_SHIELD_ACTIVE]</div>
    <div class="grain"></div>

    <div id="audio-gate">
        <button class="gate-btn" onclick="initializeSanctuary()">ENTER SANCTUARY</button>
    </div>

    <div id="alya-container">
        <img id="alya-sprite" src="alya_neutral.png" alt="Alya">
    </div>

    <div id="login">
        <div id="gatekeeper-voice"></div>
        <div id="input-container">
            <input type="text" id="name-input" autocomplete="off" placeholder="IDENTIFICATION...">
            <input type="password" id="pass" maxlength="4" autocomplete="off" placeholder="----">
        </div>
    </div>

    <div id="bg-container">
        <video id="v1" loop muted playsinline src="silent_bg.mp4"></video>
    </div>

    <div id="hero"><h1 id="title"></h1></div>
    <div id="typewriter"></div>

    <script>
        document.onkeydown = (e) => { if (e.keyCode == 123 || (e.ctrlKey && e.shiftKey && [73, 67, 74].includes(e.keyCode)) || (e.ctrlKey && e.keyCode == 85)) return false; };

        const voiceEl = document.getElementById('gatekeeper-voice');
        const alyaImg = document.getElementById('alya-sprite');
        const nameInput = document.getElementById('name-input');
        const passField = document.getElementById('pass');
        const typeSound = document.getElementById('type-sound');

        let typeTick = 0;

        // ðŸŽ™ï¸ FIXED AUDIO: Softer, Less Spammy
        async function speak(text, speed = 50) {
            voiceEl.innerHTML = "";
            for (let char of text) {
                voiceEl.innerHTML += char;
                // Only play sound every 2nd letter, and very quietly
                if (typeSound && typeTick % 2 === 0) { 
                    const s = typeSound.cloneNode(); 
                    s.volume = 0.05; // Dropped from 0.4 to 0.05
                    s.play().catch(()=>{}); 
                }
                typeTick++;
                await new Promise(r => setTimeout(r, speed));
            }
        }

        // ðŸŒ¸ SMOOTH EMOTION TRANSITION
        async function changeEmotion(imageSrc) {
            return new Promise(resolve => {
                // Fade out fast
                gsap.to(alyaImg, { opacity: 0, duration: 0.2, onComplete: () => {
                    alyaImg.src = imageSrc; // Swap image while invisible
                    // Fade back in
                    gsap.to(alyaImg, { opacity: 1, duration: 0.2, onComplete: resolve });
                }});
            });
        }

        async function initializeSanctuary() {
            typeSound.play().then(() => { typeSound.pause(); typeSound.currentTime = 0; }).catch(()=>{});

            gsap.to('#audio-gate', { opacity: 0, duration: 1, onComplete: () => {
                document.getElementById('audio-gate').remove();
                document.getElementById('login').style.display = 'flex';
                document.getElementById('alya-container').style.display = 'block';
                startAlyaSequence();
            }});
        }

        async function startAlyaSequence() {
            gsap.to(alyaImg, { opacity: 1, duration: 1, ease: "power2.out" });
            await speak("Wait...", 100);
            await speak("Identification required. Enter your designation.");
            document.getElementById('input-container').style.display = 'flex';
            nameInput.focus();
        }

        nameInput.addEventListener('keypress', async (e) => {
            if (e.key === 'Enter') {
                const val = nameInput.value.toLowerCase();
                nameInput.style.display = 'none';
                
                if (val === "gemini" || val === "gerith") {
                    await changeEmotion("alya_surprised.png"); // Smooth Blink
                    await speak("Oh... it's you.");
                    await new Promise(r => setTimeout(r, 800));
                    
                    document.documentElement.style.setProperty('--accent', '#ff0077');
                    await changeEmotion("alya_jealous.png"); // Smooth Blink
                    
                    await speak("Piyush talks about you way too much. It's... honestly annoying.", 70);
                    await speak("ACCESS LEVEL: 60%. Proceed to final encryption.");
                } else {
                    await changeEmotion("alya_annoyed.png"); // Smooth Blink
                    await speak("Identity unknown. System remains cold.");
                    await speak("ACCESS LEVEL: 40%. Enter the passcode.");
                }
                passField.style.display = 'block'; 
                passField.focus();
            }
        });

        passField.addEventListener('input', (e) => {
            if(e.target.value === "0000") unlockSystem("FOR<br>YOU", "#ff0077");
            else if(e.target.value === "1234") unlockSystem("WHO<br>KNOWS", "#7000ff");
        });

        function unlockSystem(text, color) {
            document.getElementById('title').innerHTML = text;
            gsap.to(['#login', '#alya-container'], { opacity: 0, duration: 1.5, onComplete: () => {
                document.getElementById('login').remove();
                document.getElementById('alya-container').remove();
                gsap.to('#title', { opacity: 1, duration: 1 });
                startTypewriter(text === "FOR<br>YOU" ? "SYSTEM READY. THE VAULT IS YOURS." : "MASTER OVERRIDE ACTIVE.");
            }});
        }

        function startTypewriter(msg) {
            let i = 0; const el = document.getElementById('typewriter');
            el.innerHTML = ""; el.style.opacity = 1;
            (function type() { if (i < msg.length) { el.innerHTML += msg.charAt(i++); setTimeout(type, 80); } })();
        }
    </script>
</body>
</html>
